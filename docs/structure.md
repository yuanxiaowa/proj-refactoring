# 项目构建

## 构建
- gulp进行构建
- 分析指定模式的文件，并读文件，流向其他插件
- 文件比较多的话，所需时长就随着增加
  + 开启了监听的话，每改一个文件，可能需要好几秒时间来构建，有点不能忍受
  + 虽然有 `gulp-changed` 插件，但这个插件治标不治本
    + 感觉他应该是比较源文件和目标文件的更新时间，然后决定是不是要让流继续往下，依然免不了读文件，只是没有改变的文件就不会经过其他插件进行处理，直接丢弃
  + 后面还是在监听时只对改变了的文件进行处理，节省时间
  + 使用 `gulp-changed` 进行首次运行处理，不过，如果我的某个文件依赖的东西变了，文件本身没变，就会有问题了。再者，我是通过模式匹配出来的文件，如何根据模式定位目标文件，这还得试试其他方法
- rollup进行模块打包

  > 会分析依赖，移除不需要的东东，没有提供直接传字串的接口，在gulp下运行，还需要重新去读文件，so，自己改写了一下，可以直接接收字串
  > 没有打包npm模块的功能，如 `systemjs` 和 `webpack` 就有
  > 感觉缺少其他打包工具的好多功能，后期看看是否用其他打包工具

## 外部插件
- 使用 $${name} 引用插件
  + name.js 引用js
  + name.css 引用css
  + name.subname 引用插件的子插件
- 插件目录 `src/common/lib`
- 每次需要手动去添加，后面看看能否自动管理
- 单纯的js插件的话，每次在页面中都去引用会比较麻烦，后面看看能否在js中有用到，然后再自动插入页面中

## html
- 使用pug作为模板引擎
- 默认把 `src/common/tpl/mixins` 里的mixins全部包含进来
- 引用布局页面使用 `/` 定位到 `src/common/tpl/layouts` 目录
- 页面数据定义在 `builder/datas.json`
- 用posthtml进行后续处理，功能待添加

## script
- 使用babel进行编译，可以使用es6语法
- 通用模块定义在 `src/common/js/modules` 里面
- import模块引用的 `/` 定位到 `src/common/js/`
- 单纯的插入一段js的话，如果多次用到，就需要放在单独的文件里面，再自动的插入进来
- 如果在需要单纯的模板字串，恰好在多处用到，也需要同上处理。

## style
- 使用postcss进行编译，可以使用动态语法
- 通用模块定义在 `src/common/css/modules` 里面
- @import 的 `/` 定位到 `src/common/css/`

## 组件化
- 一个组件基本的东西就是html+css，可能还会有js
- 组件我可能在html中直接嵌入，这时候可能我需要在嵌入处只是单纯的dom结构，css和js需要合并到对应的页面css和js文件中，因为通常这些文件都不大，做成内联的，不太妥，单独的文件的话，文件大还好，小的话，个人感觉浪费请求
- 若在脚本中直接调用的话，首先html是放在脚本中还是通过请求获取，js也类似，至于css，还是觉得合并到对应页面的样式里比较好
- posthtml有个webcomponent组件，但那是把html+css+js放在了一个html文件里面，使用组件的时候，把css放在头部，js放在底部
- 还有就是如何保证一步到位，即在某个地方调用，就自动把关联的东西放在对应地方

## 测试

## 其他
- 由于项目是数据和模板分离，项目不采用单页面进行处理
- 页面在加载完之后，还需要发送请求获取数据。so，每个有数据的页面至少都是两次请求
- 如果单纯的将数据塞在对应的地方的话，需要在页面上进行标识，好查找dom进行数据插入。如果数据比较多的话，就不好控制了。
- 在上面的塞数据的方式不太妥的情况下，使用模板引擎进行处理。把页面定义成模板，然后得到数据之后，与模板进行结合，渲染出最终页面
- 页面上面的相似处理需要单独提取出来，如
  + 表单验证
  + 表单提交
  + 弹框显示
  + 表格处理
  + 树形菜单处理
  + 其他